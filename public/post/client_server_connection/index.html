<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Client Server Connection | Gaffer On Games</title>

    

    
    <link href="http://173.255.195.190/gafferongames//css/bootstrap.min.css" rel="stylesheet">

    
    <link href="http://173.255.195.190/gafferongames//css/clean-blog.min.css" rel="stylesheet">

    
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    
    
    

</head>

<body>

    
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://173.255.195.190/gafferongames/">Gaffer On Games</a>
            </div>

                       
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    
                    <li>
                        <a href="http://173.255.195.190/gafferongames/">home</a>
                    </li>
                    
                    <li>
                        <a href="http://173.255.195.190/gafferongames/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="http://173.255.195.190/gafferongames/post/">Archives</a>
                    </li>
                    
                    <li>
                        <a href="http://173.255.195.190/gafferongames/contact/">Contact</a>
                    </li>
                    
                    <li>
                        <a href="http://www.patreon.com/gafferongames">Support gafferongames.com</a>
                    </li>
                    
                  </ul>
            </div>
           

        </div>
        
    </nav>


    
    
    <header class="intro-header" style="background-image: url('http://173.255.195.190/gafferongames//img/post-bg.jpg')">
    
      <div class="container">
        <div class="row">
           <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
             <div class="post-heading">
               <h1>Client Server Connection</h1>
               <h2 class="subheading">How to create a client/server connection over UDP</h2>
               <span class="meta">Posted by <a href="http://173.255.195.190/gafferongames//about">Glenn Fiedler</a> on Wednesday, September 28, 2016
               </span>
             </div>
           </div>
        </div>
      </div>
    </header>

    
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  

<h2 id="introduction">Introduction</h2>

<p>Hi, I&rsquo;m <a href="http://173.255.195.190/gafferongames/about">Glenn Fiedler</a> and welcome to <strong><a href="http://173.255.195.190/gafferongames/categories/building-a-game-network-protocol/">Building a Game Network Protocol</a></strong>.</p>

<p>In this article we&rsquo;re going to build a client/server connection on top of UDP.</p>

<p>I can guarantee you already at this point that some people have decided not to read this article because I&rsquo;m obviously a fool. Who could possibly justify all the effort required to build a completely custom client/server network protocol over UDP when for so many people, TCP is simply good enough?</p>

<p>But why is it in 2016 that discussions of UDP vs. TCP are still so controversial, when virtually all first person shooters are networked with UDP?</p>

<ul>
<li>Counterstrike</li>
<li>Call of Duty</li>
<li>Titanfall</li>
<li>Halo</li>
<li>Battlefront</li>
<li>Overwatch</li>
</ul>

<p>Clearly this is a solved problem. <strong>The game industry uses UDP.</strong></p>

<p>So what&rsquo;s going on? Why do so many games build their own custom network protocol over UDP instead of TCP? What is it about the specific use case of multiplayer gaming that makes a custom protocol built on top of UDP such a slam dunk?</p>

<h2 id="justification-for-using-udp-instead-of-tcp">Justification for using UDP instead of TCP</h2>

<p>Action games are different to web servers<a href="#quic_footnote">*</a>.</p>

<p>Action games send <strong>time critical data</strong>.</p>

<p>Time critical data is timestamped and must be received before that time to be useful. If time critical data arrives late, it is useless and is thrown away.</p>

<p>So why can&rsquo;t we use TCP for time critical data?</p>

<p>The core problem with TCP is <strong>head of line blocking</strong>.</p>

<p>This means that TCP delivers all packets reliably and in-order, so it holds more recent packets <em>(that we want)</em> hostage in a queue while older packets <em>(that we don&rsquo;t)</em> are resent over the network.</p>

<p>For example, if the server sends 10 updates per-second, the following packets are sent to a client:</p>

<pre><code>    t = 10.0
    t = 10.1
    t = 10.2
    t = 10.3
    t = 10.4
    t = 10.5
    t = 10.6
    t = 10.7
    t = 10.8
    t = 10.9
</code></pre>

<p>But if the packet containing state for time t = 10.0 is lost, under TCP we must wait for it to be resent before we can access packets t = 10.1 and 10.2, even though they&rsquo;ve already arrived. By the time the resent packet arrives, we&rsquo;d much rather have just skipped over t = 10.0 and be displaying something around 10.3 or 10.4, but TCP simply does not give us this option. All data must be delivered reliably and in-order. It&rsquo;s not possible to skip over dropped data with TCP.</p>

<p>This creates terrible problems for time critical data, leading to poor performance in situations where both packet loss and latency exist.</p>

<p>If we want the best performance when sending time critical data over the internet, it is necessary to build our own custom protocol over UDP. UDP doesn&rsquo;t provide any ordering or reliability, so we are free to drop old packets and access the most recent state that we want.</p>

<p>But using UDP comes at a cost.</p>

<p><strong>UDP doesn&rsquo;t provide any concept of connection.</strong></p>

<p>We have to build that ourselves. And that, my friend, is the subject of this article.</p>

<p><a name="quic_footnote"></a> <em>* These days even web servers are transitioning to UDP via <a href="https://ma.ttias.be/googles-quic-protocol-moving-web-tcp-udp/">Google&rsquo;s QUIC</a>. If you still think TCP is good enough for time critical data in 2016, I encourage you to put that in your pipe and smoke it.</em></p>

                </div>
            </div>
        </div>
    </article>

    <hr>
    
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <ul class="list-inline text-center">
                    <li>
                      <a href="http://173.255.195.190/gafferongames//contact/">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="https://twitter.com/gafferongames">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="https://github.com/gafferongames">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="https://www.facebook.com/gafferongames">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                  </ul>
                  <p class="copyright text-muted">Â© The Network Protocol Company, Inc.</p>
                </div>
            </div>
        </div>
    </footer>

    
    <script src="http://173.255.195.190/gafferongames//js/jquery.min.js"></script>

    
    <script src="http://173.255.195.190/gafferongames//js/bootstrap.min.js"></script>

    
    <script src="http://173.255.195.190/gafferongames//js/clean-blog.js"></script>

    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-17769864-1', 'auto');
  ga('send', 'pageview');
</script>


</body>

</html>

